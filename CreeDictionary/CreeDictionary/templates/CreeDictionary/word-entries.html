{% load inflection_extras %}
{% load static %}

{% for result in results %}
    <li class="search-results__result" data-cy="search-results">
        <article class="definition box box--rounded" data-cy="search-result">
            <header class="definition__header">
                <h2 class="definition-title definition-title--search-result">

                    <dfn class="definition-title__word" data-cy="definition-title">
                        {# upon loaded, this <a> will be attached to onclick handler that loads #}
                        {# detailed lemma page. <a> is used for accessible styling #}
                        {% if result.is_lemma %}
                            <a class="definition-title__link" href="javascript:void(0)"
                               data-lemma-id="{{ result.lemma_wordform.id }}">
                                {# data- attributes are supported in HTML5 not in XHTML #}
                                <span lang="cr">{{ result.lemma_wordform.text }}</span>
                            </a>
                        {% else %}
                            <span lang="cr">{{ result.matched_cree }}</span>
                        {% endif %}
                        <span class="definition-title__pos">({{ result.lemma_wordform|presentational_pos }})</span>
                        {% if result.linguistic_breakdown_head or result.linguistic_breakdown_tail %}
                            <div class="definition-title__tooltip">
                                <img class="definition-title__question-mark"
                                     src="{% static 'CreeDictionary/images/fa/question-circle-solid.svg' %}"
                                     alt="linguistic breakdown" data-cy="question-mark">
                                <span class="definition-title__tooltip-text"
                                      data-cy="linguistic-breakdown">{% if result.linguistic_breakdown_head %}
                                    {{ result.linguistic_breakdown_head|join:" + " }}
                                    + {% endif %}
                                    <strong>{{ result.lemma_wordform.text }}</strong> + {{ result.linguistic_breakdown_tail|join:" + " }}</span>
                            </div>
                        {% endif %}
                    </dfn>

                </h2>
            </header>

            {# Show the matched lemma (when this is NOT a lemma. #}
            {% if result.is_inflection %}
                <p class="definition-title__reference-to-lemma" data-cy="reference-to-lemma">
                    Form of
                    <a class="definition-title__link" href="javascript:void(0)"
                       data-lemma-id="{{ result.lemma_wordform.id }}">{{ result.lemma_wordform.text }}</a>
                </p>
            {% endif %}


            {# Theses are the definitions for the inflection (non-lemma), could be empty  #}
            <ol class="meanings meanings--search-result">
                {% for def in result.definitions %}
                    <li class="meanings__meaning" data-cy="lemma-meaning" data-cy="link-to-lemma">{{ def.text }}
                        {% for source in def.source_ids %}
                            <cite class="cite-dict">{{ source }}</cite>
                        {% endfor %}
                    </li>
                {% endfor %}
            </ol>

            {# show preverb breakdown #}
            <ol class="">
                {% for preverb_text, optional_id in result.preverbs %}
                    <li class="">
                        <p>Preverb: {% if optional_id %}
                            <a href="{% url 'cree-dictionary-lemma-detail' optional_id %}">{{ preverb_text }}</a>{% else %}
                            {{ preverb_text }}{% endif %}</p>
                    </li>
                {% endfor %}
            </ol>
            {# end preverb breakdown #}

            {% if result.is_inflection %}
                {# show everything about the lemma #}

                <hr>

                <header class="definition__header">
                    <h2 class="definition-title definition-title--search-result">

                        <dfn class="definition-title__word" data-cy="definition-title">
                            {# upon loaded, this <a> will be attached to onclick handler that loads #}
                            {# detailed lemma page. <a> is used for accessible styling #}
                            <a class="definition-title__link" href="javascript:void(0)"
                               data-lemma-id="{{ result.lemma_wordform.id }}">
                                {# data- attributes are supported in HTML5 not in XHTML #}
                                <span lang="cr">{{ result.lemma_wordform.text }}</span>
                            </a>
                        </dfn>
                    </h2>
                </header>

                {# Theses are the definitions for the lemma, gauranteed to exist in the database #}
                <ol class="meanings meanings--search-result">
                    {% for def in result.lemma_wordform.definitions.all %}
                        <li class="meanings__meaning" data-cy="lemma-meaning" data-cy="link-to-lemma">{{ def.text }}
                            {% for source in def.source_ids %}
                                <cite class="cite-dict">{{ source }}</cite>
                            {% endfor %}
                        </li>
                    {% endfor %}
                </ol>


            {% endif %}

        </article>
    </li>
{% endfor %}